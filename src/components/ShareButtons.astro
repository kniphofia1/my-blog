---
/**
 * 社交分享按钮组件
 * 支持分享到 Twitter/X, LinkedIn, 微博, 复制链接
 */
interface Props {
	title: string;
	description?: string;
}

const {
	title,
	description = ''
} = Astro.props;

// 编码标题和描述
const encodedTitle = encodeURIComponent(title);
---

<div class="share-container">
	<span class="share-label">分享到：</span>
	<div class="share-buttons">
		<!-- Twitter/X -->
		<a
			data-share="twitter"
			data-title={encodedTitle}
			class="share-button share-twitter"
			aria-label="分享到 Twitter/X"
			title="分享到 Twitter/X"
			target="_blank"
			rel="noopener noreferrer"
		>
			<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
				<path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
			</svg>
		</a>

		<!-- LinkedIn -->
		<a
			data-share="linkedin"
			class="share-button share-linkedin"
			aria-label="分享到 LinkedIn"
			title="分享到 LinkedIn"
			target="_blank"
			rel="noopener noreferrer"
		>
			<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
				<path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
			</svg>
		</a>

		<!-- 微博 -->
		<a
			data-share="weibo"
			data-title={encodedTitle}
			class="share-button share-weibo"
			aria-label="分享到微博"
			title="分享到微博"
			target="_blank"
			rel="noopener noreferrer"
		>
			<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
				<path d="M10.098 20c-4.627 0-8.5-3.384-8.5-7.602 0-4.219 3.873-7.603 8.5-7.603s8.5 3.384 8.5 7.603c0 4.218-3.873 7.602-8.5 7.602zm0-13.605c-3.213 0-5.897 2.577-5.897 5.893 0 3.316 2.684 5.894 5.897 5.894 3.213 0 5.897-2.578 5.897-5.894 0-3.316-2.684-5.893-5.897-5.893z"/>
				<path d="M10.098 17.067c-2.648 0-4.947-1.938-4.947-4.376 0-2.438 2.299-4.376 4.947-4.376 2.648 0 4.947 1.938 4.947 4.376 0 2.438-2.299 4.376-4.947 4.376zm0-7.252c-1.684 0-3.097 1.244-3.097 2.876 0 1.632 1.413 2.876 3.097 2.876 1.684 0 3.097-1.244 3.097-2.876 0-1.632-1.413-2.876-3.097-2.876z"/>
				<ellipse cx="13.475" cy="5.953" rx="1.792" ry="1.792"/>
			</svg>
		</a>

		<!-- 复制链接 -->
		<button
			class="share-button share-copy"
			aria-label="复制链接"
			title="复制链接"
		>
			<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
				<rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
				<path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
			</svg>
			<span class="copy-text">复制</span>
		</button>
	</div>
</div>

<script define:vars={{ encodedTitle }}>
	const url = window.location.href;
	const encodedUrl = encodeURIComponent(url);

	// 设置分享链接
	function initShareButtons() {
		const shareButtons = document.querySelectorAll('[data-share]');

		shareButtons.forEach(button => {
			const platform = button.getAttribute('data-share');
			let shareUrl = '';

			switch (platform) {
				case 'twitter':
					shareUrl = `https://twitter.com/intent/tweet?text=${encodedTitle}&url=${encodedUrl}`;
					break;
				case 'linkedin':
					shareUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${encodedUrl}`;
					break;
				case 'weibo':
					shareUrl = `https://service.weibo.com/share/share.php?title=${encodedTitle}&url=${encodedUrl}`;
					break;
			}

			button.href = shareUrl;
		});
	}

	// 初始化分享按钮
	initShareButtons();

	// 复制链接功能
	function copyLink() {
		const url = window.location.href;
		navigator.clipboard.writeText(url).then(() => {
			const copyButton = document.querySelector('.share-copy');
			const copyText = copyButton.querySelector('.copy-text');
			const originalText = copyText.textContent;

			copyText.textContent = '已复制!';
			copyButton.classList.add('copied');

			setTimeout(() => {
				copyText.textContent = originalText;
				copyButton.classList.remove('copied');
			}, 2000);
		}).catch(err => {
			console.error('复制失败:', err);
			alert('复制失败，请手动复制链接');
		});
	}

	// 绑定复制按钮事件
	const copyButton = document.querySelector('.share-copy');
	if (copyButton) {
		copyButton.addEventListener('click', copyLink);
	}
</script>

<style>
	.share-container {
		display: flex;
		align-items: center;
		gap: var(--space-md);
		padding: var(--space-lg) 0;
		border-top: 1px solid var(--border-color);
		margin-top: var(--space-xl);
	}

	.share-label {
		font-size: 0.9375rem;
		font-weight: 500;
		color: var(--text-secondary);
	}

	.share-buttons {
		display: flex;
		gap: var(--space-sm);
		align-items: center;
	}

	.share-button {
		display: inline-flex;
		align-items: center;
		justify-content: center;
		gap: var(--space-xs);
		padding: var(--space-sm) var(--space-md);
		background: var(--glass-bg);
		backdrop-filter: var(--glass-blur);
		-webkit-backdrop-filter: var(--glass-blur);
		border: 1px solid var(--glass-border);
		border-radius: var(--radius-full);
		color: var(--text-secondary);
		text-decoration: none;
		font-size: 0.875rem;
		font-weight: 500;
		transition: all var(--transition-base);
		cursor: pointer;
		box-shadow: var(--shadow-sm);
		min-width: 40px;
		height: 40px;
	}

	.share-button:hover {
		transform: translateY(-2px);
		box-shadow: var(--shadow-md);
		border-color: var(--accent);
	}

	.share-button svg {
		width: 18px;
		height: 18px;
		transition: transform var(--transition-base);
	}

	.share-button:hover svg {
		transform: scale(1.1);
	}

	/* Twitter 特定样式 */
	.share-twitter:hover {
		background: linear-gradient(135deg, #000000 0%, #1DA1F2 100%);
		color: white;
		border-color: transparent;
	}

	/* LinkedIn 特定样式 */
	.share-linkedin:hover {
		background: linear-gradient(135deg, #0077B5 0%, #00A0DC 100%);
		color: white;
		border-color: transparent;
	}

	/* 微博特定样式 */
	.share-weibo:hover {
		background: linear-gradient(135deg, #E6162D 0%, #FF8200 100%);
		color: white;
		border-color: transparent;
	}

	/* 复制按钮特定样式 */
	.share-copy {
		background: rgba(245, 242, 237, 0.8);
	}

	.share-copy:hover {
		background: var(--gradient-primary);
		color: white;
		border-color: transparent;
	}

	.share-copy.copied {
		background: var(--forest-200);
		color: white;
		border-color: transparent;
	}

	.share-copy .copy-text {
		font-size: 0.8125rem;
	}

	/* 响应式 */
	@media (max-width: 768px) {
		.share-container {
			flex-direction: column;
			align-items: flex-start;
			gap: var(--space-sm);
		}

		.share-buttons {
			flex-wrap: wrap;
		}

		.share-button {
			padding: var(--space-xs) var(--space-sm);
			min-width: 36px;
			height: 36px;
		}

		.share-button svg {
			width: 16px;
			height: 16px;
		}
	}
</style>
